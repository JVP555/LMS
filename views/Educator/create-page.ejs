<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= title %></title>
  <script>
    const maxCharacters = 100000;

    function updateCharCount() {
      const content = document.getElementById("content");
      const charCount = document.getElementById("charCount");
      const currentLength = content.value.length;

      charCount.textContent = `${currentLength} / ${maxCharacters} characters`;

      if (currentLength > maxCharacters) {
        content.setCustomValidity("Content exceeds the maximum allowed characters.");
        charCount.classList.remove("text-gray-500");
        charCount.classList.add("text-red-500");
      } else {
        content.setCustomValidity("");
        charCount.classList.add("text-gray-500");
        charCount.classList.remove("text-red-500");
      }
    }

    window.addEventListener("DOMContentLoaded", updateCharCount);
  </script>
  <style>
    .fixed-bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
      z-index: 20;
    }

    body {
      padding-bottom: 100px; /* Prevent content from being hidden by fixed bar */
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <%- include('../General/header') %>
  <%- include('../General/notifications', { messages: messages }) %>

<% let formAction = ''; %>
<% if (title === 'Create New Page') { %>
  <% formAction = '/my-chapter/' + chapterId + '/my-pages'; %>
<% } else if (title === 'Edit Page') { %>
  <% formAction = '/pages/' + page.id + '/edit'; %>
<% } %>

<div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg mt-12">
  <!-- Page Title -->
  <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center"><%= title %></h1>

  <!-- Subheading -->
  <h2 class="text-xl font-semibold text-gray-700 mb-6 text-center">
    <%= title === 'Edit Page' ? 'Update Page Details' : 'Create a New Page' %>
  </h2>

  <!-- Form -->
  <form id="mainForm" method="POST" action="<%= formAction %>">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">

    <!-- Page Title -->
    <div class="mb-4">
      <label for="title" class="block text-lg font-medium text-gray-700 mb-2">Page Title:</label>
      <input 
        type="text" 
        id="title" 
        name="title" 
        value="<%= page.title || '' %>"
        required
        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
      >
    </div>

    <!-- Page Content -->
    <div class="mb-2">
      <label for="content" class="block text-lg font-medium text-gray-700 mb-2">Content:</label>
      <textarea 
        id="content" 
        name="content" 
        rows="10"
        maxlength="1800000"
        oninput="updateCharCount()"
        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
      ><%= page.content || '' %></textarea>
    </div>
  </form>
</div>

<!-- Fixed bottom bar with character counter and submit button -->
<div class="fixed-bottom-bar">
  <div id="charCount" class="text-sm text-gray-500 self-center">0 / 100000 characters</div>
  <button 
    type="submit"
    form="mainForm"
    onclick="document.querySelector('form').reportValidity()" 
    class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50"
  >
    <%= title.includes('Edit') ? 'Update' : 'Create' %> Page
  </button>
</div>
</body>
</html>
